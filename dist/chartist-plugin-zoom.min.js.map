{"version":3,"sources":["chartist-plugin-zoom.js"],"names":["root","factory","define","amd","Chartist","returnExportsGlobal","exports","module","require","this","window","document","hide","rect","attr","style","show","getRect","firstPoint","secondPoint","x","y","width","height","position","event","svg","transform","clientX","clientY","svgElement","tagName","ownerSVGElement","matrix","getScreenCTM","point","createSVGPoint","matrixTransform","inverse","project","value","axis","bounds","range","max","min","scale","type","base","Math","pow","baseLog","axisLength","val","log","defaultOptions","pointClipOffset","plugins","zoom","options","extend","chart","copyTouch","touch","p","id","identifier","ongoingTouchIndexById","idToFind","i","ongoingTouches","length","onTouchStart","touches","changedTouches","push","onTouchMove","idx","splice","preventDefault","onTouchCancel","removeTouches","onTouchEnd","zoomIn","onMouseDown","button","isInRect","chartRect","downPosition","x1","x2","y2","y1","onMouseUp","resetOnRightMouseBtn","reset","axisX","highLow","low","high","axisY","update","data","onZoom","onMouseMove","Line","on","mask","element","clip-path","addMask","offset","defs","elem","fill","handler","addEventListener","_node","querySelector"],"mappings":"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","file":"chartist-plugin-zoom.min.js","sourcesContent":["(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([\"chartist\"], function (Chartist) {\n      return (root.returnExportsGlobal = factory(Chartist));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"chartist\"));\n  } else {\n    root['Chartist.plugins.zoom'] = factory(Chartist);\n  }\n}(this, function (Chartist) {\n\n  /**\n   * Chartist.js zoom plugin.\n   *\n   */\n  (function (window, document, Chartist) {\n    'use strict';\n\n    var defaultOptions = {\n      // onZoom\n      // resetOnRightMouseBtn\n      pointClipOffset: 5\n    };\n\n    Chartist.plugins = Chartist.plugins || {};\n    Chartist.plugins.zoom = function (options) {\n\n      options = Chartist.extend({}, defaultOptions, options);\n\n      return function zoom(chart) {\n\n        if (!(chart instanceof Chartist.Line)) {\n          return;\n        }\n\n        var rect, svg, axisX, axisY, chartRect;\n        var downPosition;\n        var onZoom = options.onZoom;\n        var ongoingTouches = [];\n\n        chart.on('draw', function (data) {\n          var type = data.type;\n          var mask = type === 'point' ? 'point-mask' : 'line-mask';\n          if (type === 'line' || type === 'bar' || type === 'area' || type === 'point') {\n            data.element.attr({ 'clip-path': 'url(#' + mask + ')' });\n          }\n        });\n\n        chart.on('created', function (data) {\n          axisX = data.axisX;\n          axisY = data.axisY;\n          chartRect = data.chartRect;\n          svg = data.svg._node;\n          rect = data.svg.elem('rect', {\n            x: 10,\n            y: 10,\n            width: 100,\n            height: 100,\n          }, 'ct-zoom-rect');\n          hide(rect);\n\n          var defs = data.svg.querySelector('defs') || data.svg.elem('defs');\n          var width = chartRect.width();\n          var height = chartRect.height();\n\n          function addMask(id, offset) {\n            defs\n              .elem('clipPath', {\n                id: id\n              })\n              .elem('rect', {\n                x: chartRect.x1 - offset,\n                y: chartRect.y2 - offset,\n                width: width + offset + offset,\n                height: height + offset + offset,\n                fill: 'white'\n              });\n          }\n          addMask('line-mask', 0);\n          addMask('point-mask', options.pointClipOffset);\n\n          function on(event, handler) {\n            svg.addEventListener(event, handler);\n          }\n\n          on('mousedown', onMouseDown);\n          on('mouseup', onMouseUp);\n          on('mousemove', onMouseMove);\n          on('touchstart', onTouchStart);\n          on('touchmove', onTouchMove);\n          on('touchend', onTouchEnd);\n          on('touchcancel', onTouchCancel);\n        });\n\n\n\n        function copyTouch(touch) {\n          var p = position(touch, svg);\n          p.id = touch.identifier;\n          return p;\n        }\n\n        function ongoingTouchIndexById(idToFind) {\n          for (var i = 0; i < ongoingTouches.length; i++) {\n            var id = ongoingTouches[i].id;\n            if (id === idToFind) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function onTouchStart(event) {\n          var touches = event.changedTouches;\n          for (var i = 0; i < touches.length; i++) {\n            ongoingTouches.push(copyTouch(touches[i]));\n          }\n\n          if (ongoingTouches.length > 1) {\n            rect.attr(getRect(ongoingTouches[0], ongoingTouches[1]));\n            show(rect);\n          }\n        }\n\n        function onTouchMove(event) {\n          var touches = event.changedTouches;\n          for (var i = 0; i < touches.length; i++) {\n            var idx = ongoingTouchIndexById(touches[i].identifier);\n            ongoingTouches.splice(idx, 1, copyTouch(touches[i]));\n          }\n\n          if (ongoingTouches.length > 1) {\n            rect.attr(getRect(ongoingTouches[0], ongoingTouches[1]));\n            show(rect);\n            event.preventDefault();\n          }\n        }\n\n        function onTouchCancel(event) {\n          removeTouches(event.changedTouches);\n        }\n\n        function removeTouches(touches) {\n          for (var i = 0; i < touches.length; i++) {\n            var idx = ongoingTouchIndexById(touches[i].identifier);\n            if (idx >= 0) {\n              ongoingTouches.splice(idx, 1);\n            }\n          }\n        }\n\n        function onTouchEnd(event) {\n          if (ongoingTouches.length > 1) {\n            zoomIn(getRect(ongoingTouches[0], ongoingTouches[1]));\n          }\n          removeTouches(event.changedTouches);\n          hide(rect);\n        }\n\n        function onMouseDown(event) {\n          if (event.button === 0) {\n            var point = position(event, svg);\n            if (isInRect(point, chartRect)) {\n              downPosition = point;\n              rect.attr(getRect(downPosition, downPosition));\n              show(rect);\n              event.preventDefault();\n            }\n          }\n        }\n\n        function isInRect(point, rect) {\n          return point.x >= rect.x1 && point.x <= rect.x2 && point.y >= rect.y2 && point.y <= rect.y1;\n        }\n\n        var reset = function () {\n          chart.options.axisX.highLow = null;\n          chart.options.axisY.highLow = null;\n          chart.update(chart.data, chart.options);\n        };\n\n        function onMouseUp(event) {\n          if (event.button === 0 && downPosition) {\n            var box = getRect(downPosition, position(event, svg));\n            zoomIn(box);\n            downPosition = null;\n            hide(rect);\n          }\n          else if (options.resetOnRightMouseBtn && event.button === 2) {\n            reset();\n            event.preventDefault();\n          }\n        }\n\n        function zoomIn(rect) {\n          if (rect.width > 5 && rect.height > 5) {\n              var x1 = Math.max(0, rect.x - chartRect.x1);\n              var x2 = Math.min(chartRect.width(), x1 + rect.width);\n              var y2 = Math.min(chartRect.height(), chartRect.y1 - rect.y);\n              var y1 = Math.max(0, y2 - rect.height);\n\n              chart.options.axisX.highLow = { low: project(x1, axisX), high: project(x2, axisX) };\n              chart.options.axisY.highLow = { low: project(y1, axisY), high: project(y2, axisY) };\n\n              chart.update(chart.data, chart.options);\n              onZoom && onZoom(chart, reset);\n            }\n        }\n\n        function onMouseMove(event) {\n          if (downPosition) {\n            var point = position(event, svg);\n            if (isInRect(point, chartRect)) {\n              rect.attr(getRect(downPosition, point));\n              event.preventDefault();\n            }\n          }\n        }\n      };\n\n    };\n\n    function hide(rect) {\n      rect.attr({ style: 'display:none' });\n    }\n\n    function show(rect) {\n      rect.attr({ style: 'display:block' });\n    }\n\n    function getRect(firstPoint, secondPoint) {\n      var x = firstPoint.x;\n      var y = firstPoint.y;\n      var width = secondPoint.x - x;\n      var height = secondPoint.y - y;\n      if (width < 0) {\n        width = -width;\n        x = secondPoint.x;\n      }\n      if (height < 0) {\n        height = -height;\n        y = secondPoint.y;\n      }\n      return {\n        x: x,\n        y: y,\n        width: width,\n        height: height\n      };\n    }\n\n    function position(event, svg) {\n      return transform(event.clientX, event.clientY, svg);\n    }\n\n    function transform(x, y, svgElement) {\n      var svg = svgElement.tagName === 'svg' ? svgElement : svgElement.ownerSVGElement;\n      var matrix = svg.getScreenCTM();\n      var point = svg.createSVGPoint();\n      point.x = x;\n      point.y = y;\n      point = point.matrixTransform(matrix.inverse());\n      return point || { x: 0, y: 0 };\n    }\n\n    function project(value, axis) {\n      var bounds = axis.bounds || axis.range;\n      var max = bounds.max;\n      var min = bounds.min;\n      if (axis.scale && axis.scale.type === 'log') {\n        var base = axis.scale.base;\n        return Math.pow(base,\n          value * baseLog(max / min, base) / axis.axisLength) * min;\n      }\n      var range = bounds.range || (max - min);\n      return (value * range / axis.axisLength) + min;\n    }\n\n    function baseLog(val, base) {\n      return Math.log(val) / Math.log(base);\n    }\n\n  } (window, document, Chartist));\n\n  return Chartist.plugins.zoom;\n\n}));\n"]}